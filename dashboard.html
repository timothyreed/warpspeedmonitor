<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WarpSpeed - AI Performance Monitor</title>
    
    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        'starfleet': {
                            50: '#fff8f3',
                            100: '#ffedd9',
                            200: '#ffd6a6',
                            300: '#ffb366',
                            400: '#ff8c42',
                            500: '#ff6600',
                            600: '#cc5200',
                            700: '#993d00',
                            800: '#662900',
                            900: '#331400',
                        },
                        'lcars': {
                            400: '#9999ff',
                            500: '#6666ff',
                            600: '#3333ff',
                        },
                        'tactical': {
                            400: '#ff4444',
                            500: '#ff0000',
                            600: '#cc0000',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 5px #00f5ff, 0 0 10px #00f5ff, 0 0 15px #00f5ff' },
                            '100%': { boxShadow: '0 0 10px #00f5ff, 0 0 20px #00f5ff, 0 0 30px #00f5ff' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'gradient-conic': 'conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))',
                        'grid-pattern': 'linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px)',
                    },
                    backdropBlur: {
                        xs: '2px',
                    }
                }
            }
        }
    </script>
    
    <!-- Custom CSS -->
    <style>
        .system-card {
            background: #1e1f23;
            border: 1px solid #2d2e33;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            transition: all 0.15s ease;
        }
        
        .system-card:hover {
            background: #212228;
            border-color: #353640;
            transform: translateY(-1px);
        }
        
        .header-card {
            background: #1e1f23;
            border: 1px solid #2d2e33;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .glass-morphism {
            background: #1e1f23;
            border: 1px solid #2d2e33;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .dark .glass-morphism {
            background: #1e1f23;
            border: 1px solid #2d2e33;
        }
        
        .metric-section {
            background: #16171a;
            border: 1px solid #24252a;
            border-radius: 4px;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.4);
        }
        
        .metric-item {
            background: #1a1b1f;
            border: 1px solid #26272c;
            border-radius: 4px;
            transition: all 0.12s ease;
        }
        
        .metric-item:hover {
            background: #1d1e23;
            border-color: #2c2d32;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #ffffff;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #9ca3af;
            font-weight: 500;
        }
        
        .progress-bar {
            height: 3px;
            background: #2a2b30;
            border-radius: 2px;
            overflow: hidden;
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.4);
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 2px;
            background: #5a5b60;
            box-shadow: 0 1px 1px rgba(255, 255, 255, 0.1);
        }
        
        .status-green { color: #10b981; }
        .status-yellow { color: #f59e0b; }
        .status-red { color: #ef4444; }
        .status-blue { color: #3b82f6; }
        .status-purple { color: #8b5cf6; }
        
        .neon-glow {
            box-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor;
        }
        
        .grid-bg {
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.15) 1px, transparent 0);
            background-size: 20px 20px;
        }
        
        .dark .grid-bg {
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.1) 1px, transparent 0);
        }
        
        .metric-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .metric-card:hover {
            transform: translateY(-2px) scale(1.02);
        }
        
        .warp-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .dark .warp-gradient {
            background: linear-gradient(135deg, #4c1d95 0%, #1e3a8a 100%);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 3px;
        }
        
        .loading-dots::after {
            content: '';
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body class="bg-gray-900 dark:bg-gray-900 min-h-screen transition-all duration-300">
    
    <!-- Main Container -->
    <div id="app" class="relative z-10"></div>
    
    <script>
        // Theme management
        let isDarkMode = localStorage.theme === 'dark' || (!localStorage.theme && window.matchMedia('(prefers-color-scheme: dark)').matches);
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            localStorage.theme = isDarkMode ? 'dark' : 'light';
            updateTheme();
            // Don't trigger animations for theme changes
            isInitialLoad = false;
            renderDashboard();
        }
        
        function updateTheme() {
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        // Initialize theme
        updateTheme();
        
        // Dashboard data and state
        let metrics = {};
        let autoRefresh = true;
        let activeView = 'overview';
        let isLoading = false;
        let isInitialLoad = true;
        let hasRenderedOnce = false;
        
        async function fetchMetrics() {
            try {
                isLoading = true;
                renderDashboard();
                
                const response = await fetch('http://localhost:8001/api/v1/monitoring/all');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                metrics = await response.json();
                isLoading = false;
                renderDashboard();
                isInitialLoad = false; // After first successful load
            } catch (error) {
                console.error('Failed to fetch metrics:', error);
                isLoading = false;
                document.getElementById('app').innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-6">
                        <div class="glass-morphism rounded-2xl p-8 text-center max-w-md animate-slide-up">
                            <div class="text-red-400 text-5xl mb-4">‚ö†Ô∏è</div>
                            <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-2">Connection Failed</h2>
                            <p class="text-gray-600 dark:text-gray-300 mb-4">Unable to connect to WarpSpeed monitoring server.</p>
                            <button onclick="fetchMetrics()" class="px-4 py-2 bg-warp-500 text-white rounded-lg hover:bg-warp-600 transition-all">
                                Retry Connection
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        function getStatusColor(status) {
            switch (status?.toLowerCase()) {
                case 'healthy':
                case 'running': 
                    return 'text-neon-500';
                case 'down':
                case 'error': 
                    return 'text-red-400';
                default: 
                    return 'text-yellow-400';
            }
        }
        
        function getPerformanceColor(percentage) {
            if (percentage >= 80) return 'text-neon-500';
            if (percentage >= 60) return 'text-yellow-400';
            return 'text-red-400';
        }
        
        function renderDashboard() {
            const app = document.getElementById('app');
            const lastUpdate = new Date().toLocaleTimeString();
            
            // Only add initial animations on first render
            const containerClasses = isInitialLoad ? 'container mx-auto p-6 max-w-7xl animate-fade-in' : 'container mx-auto p-6 max-w-7xl';
            
            app.innerHTML = `
                <div class="${containerClasses}">
                    <!-- Header -->
                    <header class="mb-4">
                        <div class="header-card p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <div class="w-6 h-6 bg-gray-600 rounded-sm flex items-center justify-center">
                                        <span class="text-gray-200 text-xs font-bold">‚ö°</span>
                                    </div>
                                    <div>
                                        <h1 class="text-lg font-medium text-white">
                                            WarpSpeed
                                        </h1>
                                        <p class="text-xs text-gray-400 leading-none">
                                            AI Performance Monitor
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right text-gray-400">
                                    <div class="text-xs">
                                        ${isLoading ? 'Updating...' : `${lastUpdate}`}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    <!-- Controls -->
                    <div class="mb-4">
                        <div class="glass-morphism p-3">
                            <div class="flex flex-wrap items-center justify-between gap-3">
                                <!-- View Tabs -->
                                <div class="flex flex-wrap gap-1">
                                    ${['overview', 'system', 'container', 'tokens'].map(view => `
                                        <button 
                                            onclick="setView('${view}')" 
                                            class="px-3 py-1.5 rounded text-sm font-medium transition-all ${
                                                activeView === view 
                                                    ? 'bg-gray-600 text-white shadow-sm' 
                                                    : 'text-gray-400 hover:bg-gray-800 hover:text-gray-200'
                                            }"
                                        >
                                            ${view === 'tokens' ? 'ü™ô Tokens' : view.charAt(0).toUpperCase() + view.slice(1)}
                                        </button>
                                    `).join('')}
                                </div>
                                
                                <!-- Controls -->
                                <div class="flex items-center gap-1">
                                    <button
                                        onclick="toggleTheme()"
                                        class="p-1.5 rounded text-gray-400 hover:bg-gray-800 hover:text-gray-200 transition-all text-sm"
                                        title="Toggle theme"
                                    >
                                        ${isDarkMode ? '‚òÄÔ∏è' : 'üåô'}
                                    </button>
                                    
                                    <button
                                        onclick="toggleAutoRefresh()"
                                        class="px-2.5 py-1.5 rounded text-sm font-medium transition-all ${
                                            autoRefresh 
                                                ? 'bg-gray-600 text-white shadow-sm' 
                                                : 'text-gray-400 hover:bg-gray-800 hover:text-gray-200'
                                        }"
                                    >
                                        ${autoRefresh ? '‚è∏Ô∏è Live' : '‚ñ∂Ô∏è Paused'}
                                    </button>
                                    
                                    <button
                                        onclick="fetchMetrics()"
                                        class="p-1.5 rounded text-gray-400 hover:bg-gray-800 hover:text-gray-200 transition-all text-sm ${isLoading ? 'animate-pulse' : ''}"
                                        title="Refresh now"
                                    >
                                        üîÑ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <main class="${isInitialLoad ? 'animate-slide-up' : ''}">
                        ${renderContent()}
                    </main>
                </div>
            `;
        }
        
        function renderContent() {
            switch (activeView) {
                case 'overview':
                    return renderOverview();
                case 'system':
                    return renderSystem();
                case 'container':
                    return renderContainer();
                case 'tokens':
                    return renderTokens();
                default:
                    return '<div class="text-center">Select a view</div>';
            }
        }
        
        function renderOverview() {
            const system = metrics.system || {};
            const container = metrics.container || {};
            const services = metrics.services?.services || {};
            const models = metrics.models || {};
            const tokens = metrics.tokens?.usage_summary || {};
            const ollamaTokens = metrics.tokens?.ollama_tokens || {};
            
            return `
                <!-- System Overview Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-3 mb-4">
                    <!-- CPU Usage -->
                    <div class="system-card p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xs text-gray-400 font-medium uppercase tracking-wide">CPU</h3>
                            <div class="text-sm font-semibold text-white">${system.cpu?.percent || 0}%</div>
                        </div>
                        <div class="progress-bar mb-2">
                            <div class="progress-fill transition-all duration-500" style="width: ${system.cpu?.percent || 0}%"></div>
                        </div>
                        <div class="text-xs text-gray-500">${system.cpu?.count || 0} cores</div>
                        ${system.cpu?.load_avg ? `<div class="text-xs text-gray-500">Load: ${system.cpu.load_avg[0]?.toFixed(2) || 'N/A'}</div>` : ''}
                    </div>
                    
                    <!-- Memory Usage -->
                    <div class="system-card p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xs text-gray-400 font-medium uppercase tracking-wide">Memory</h3>
                            <div class="text-sm font-semibold text-white">${system.memory?.percent || 0}%</div>
                        </div>
                        <div class="progress-bar mb-2">
                            <div class="progress-fill transition-all duration-500" style="width: ${system.memory?.percent || 0}%"></div>
                        </div>
                        <div class="text-xs text-gray-500">${formatBytes(system.memory?.used || 0)}</div>
                        <div class="text-xs text-gray-500">${system.memory?.available_gb || 0}GB free</div>
                    </div>
                    
                    <!-- Disk Usage -->
                    <div class="system-card p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xs text-gray-400 font-medium uppercase tracking-wide">Disk</h3>
                            <div class="text-sm font-semibold text-white">${system.disk?.percent || 0}%</div>
                        </div>
                        <div class="progress-bar mb-2">
                            <div class="progress-fill transition-all duration-500" style="width: ${system.disk?.percent || 0}%"></div>
                        </div>
                        <div class="text-xs text-gray-500">${formatBytes(system.disk?.free || 0)} free</div>
                        <div class="text-xs text-gray-500">${formatBytes(system.disk?.total || 0)} total</div>
                    </div>
                    
                    <!-- Container Status -->
                    <div class="system-card p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xs text-gray-400 font-medium uppercase tracking-wide">Container</h3>
                            <div class="text-xs font-semibold ${getStatusColor(container.status)}">${container.status || 'Unknown'}</div>
                        </div>
                        <div class="text-xs text-gray-500 mb-1">CPU: ${container.cpu_percent || 'N/A'}</div>
                        <div class="text-xs text-gray-500">Mem: ${container.memory_percent || 'N/A'}</div>
                        <div class="text-xs text-gray-500">PIDs: ${container.pids || 'N/A'}</div>
                    </div>
                    
                    <!-- AI Performance -->
                    <div class="system-card p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xs text-gray-400 font-medium uppercase tracking-wide">AI Score</h3>
                            <div class="text-sm font-semibold ${getPerformanceColor(tokens.performance_score || 0)}">${Math.round(tokens.performance_score || 0)}%</div>
                        </div>
                        <div class="text-xs text-gray-500 mb-1">${tokens.estimated_throughput_tokens_per_second || 0} tok/sec</div>
                        <div class="text-xs text-gray-500">Impact: ${tokens.system_load_impact || 'Unknown'}</div>
                        <div class="text-xs text-gray-500">${tokens.memory_available_for_tokens || 'N/A'} avail</div>
                    </div>
                    
                    <!-- Network Activity -->
                    <div class="system-card p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xs text-gray-400 font-medium uppercase tracking-wide">Network</h3>
                            <div class="text-xs font-semibold text-white">üì°</div>
                        </div>
                        <div class="text-xs text-gray-500 mb-1">${container.network_io || 'No data'}</div>
                        <div class="text-xs text-gray-500">Block I/O:</div>
                        <div class="text-xs text-gray-500">${container.block_io || 'No data'}</div>
                    </div>
                </div>
                
                <!-- Detailed Sections Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3 mb-4">
                    
                    <!-- Services Health -->
                    <div class="glass-morphism p-3">
                        <h3 class="text-sm font-medium text-white mb-3 flex items-center uppercase tracking-wide">
                            <span class="mr-1.5 text-xs">üåê</span>
                            Services
                        </h3>
                        <div class="space-y-1">
                            ${Object.entries(services).length > 0 ? Object.entries(services).map(([service, data]) => `
                                <div class="metric-item flex items-center justify-between p-2">
                                    <div>
                                        <div class="text-xs font-medium text-white capitalize">${service.replace('_', ' ')}</div>
                                        <div class="text-xs text-gray-500">${data.url || ''}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xs font-semibold ${getStatusColor(data.status)}">${data.status}</div>
                                        ${data.response_time_ms ? `<div class="text-xs text-gray-500">${data.response_time_ms}ms</div>` : ''}
                                    </div>
                                </div>
                            `).join('') : '<div class="text-gray-500 text-xs">No services data</div>'}
                        </div>
                    </div>
                    
                    <!-- Available Models -->
                    <div class="glass-morphism p-3">
                        <h3 class="text-sm font-medium text-white mb-3 flex items-center uppercase tracking-wide">
                            <span class="mr-1.5 text-xs">üìö</span>
                            Models
                        </h3>
                        <div class="space-y-1 max-h-40 overflow-y-auto">
                            ${ollamaTokens.available_models && ollamaTokens.available_models.length > 0 ? ollamaTokens.available_models.map(model => `
                                <div class="metric-item flex items-center justify-between p-2">
                                    <div>
                                        <div class="text-xs font-medium text-white">${model.name}</div>
                                        <div class="text-xs text-gray-500">${model.size}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xs text-gray-400">${model.estimated_context_tokens || 'N/A'}</div>
                                        <div class="text-xs text-gray-500">tokens</div>
                                    </div>
                                </div>
                            `).join('') : '<div class="text-gray-500 text-xs">No models available</div>'}
                        </div>
                    </div>
                    
                    <!-- Active Models -->
                    <div class="glass-morphism p-3">
                        <h3 class="text-sm font-medium text-white mb-3 flex items-center uppercase tracking-wide">
                            <span class="mr-1.5 text-xs">‚ö°</span>
                            Active
                        </h3>
                        <div class="space-y-1">
                            ${ollamaTokens.active_models && ollamaTokens.active_models.length > 0 ? ollamaTokens.active_models.map(model => `
                                <div class="metric-item flex items-center justify-between p-2 border border-gray-600">
                                    <div>
                                        <div class="text-xs font-medium text-white flex items-center">
                                            <span class="w-1.5 h-1.5 bg-green-400 rounded-full mr-2 animate-pulse"></span>
                                            ${model.name}
                                        </div>
                                        <div class="text-xs text-gray-500">${model.size}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xs text-green-400 font-medium">Running</div>
                                        <div class="text-xs text-gray-500">${model.processor || 'CPU'}</div>
                                    </div>
                                </div>
                            `).join('') : '<div class="text-gray-500 text-xs">No active models</div>'}
                        </div>
                    </div>
                </div>
                
                <!-- System Details Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                    <!-- CPU Details -->
                    <div class="glass-morphism p-3">
                        <h4 class="text-sm font-medium text-white mb-2 flex items-center uppercase tracking-wide">
                            <span class="mr-1.5 text-xs">üñ•Ô∏è</span>
                            CPU Details
                        </h4>
                        <div class="space-y-1.5 text-xs">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Usage:</span>
                                <span class="text-white">${system.cpu?.percent || 0}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Cores:</span>
                                <span class="text-white">${system.cpu?.count || 0}</span>
                            </div>
                            ${system.cpu?.load_avg ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Load 1m:</span>
                                    <span class="text-white">${system.cpu.load_avg[0]?.toFixed(2) || 'N/A'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Load 5m:</span>
                                    <span class="text-white">${system.cpu.load_avg[1]?.toFixed(2) || 'N/A'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Load 15m:</span>
                                    <span class="text-white">${system.cpu.load_avg[2]?.toFixed(2) || 'N/A'}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Memory Details -->
                    <div class="glass-morphism rounded-xl p-4">
                        <h4 class="text-md font-semibold text-white mb-3 flex items-center">
                            <span class="mr-2">üíæ</span>
                            Memory Details
                        </h4>
                        <div class="space-y-2 text-xs">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Usage:</span>
                                <span class="text-white">${system.memory?.percent || 0}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Used:</span>
                                <span class="text-white">${formatBytes(system.memory?.used || 0)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Available:</span>
                                <span class="text-white">${formatBytes(system.memory?.available || 0)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Total:</span>
                                <span class="text-white">${formatBytes(system.memory?.total || 0)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Container Details -->
                    <div class="glass-morphism rounded-xl p-4">
                        <h4 class="text-md font-semibold text-white mb-3 flex items-center">
                            <span class="mr-2">üê≥</span>
                            Container
                        </h4>
                        <div class="space-y-2 text-xs">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Status:</span>
                                <span class="${getStatusColor(container.status)}">${container.status || 'Unknown'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Name:</span>
                                <span class="text-white">${container.name || 'N/A'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">CPU:</span>
                                <span class="text-white">${container.cpu_percent || 'N/A'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Memory:</span>
                                <span class="text-white">${container.memory_usage || 'N/A'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">PIDs:</span>
                                <span class="text-white">${container.pids || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Token Performance -->
                    <div class="glass-morphism rounded-xl p-4">
                        <h4 class="text-md font-semibold text-white mb-3 flex items-center">
                            <span class="mr-2">ü™ô</span>
                            Token Metrics
                        </h4>
                        <div class="space-y-2 text-xs">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Score:</span>
                                <span class="${getPerformanceColor(tokens.performance_score || 0)}">${Math.round(tokens.performance_score || 0)}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Throughput:</span>
                                <span class="text-white">${tokens.estimated_throughput_tokens_per_second || 0}/sec</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Impact:</span>
                                <span class="text-white capitalize">${tokens.system_load_impact || 'Unknown'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Available:</span>
                                <span class="text-white">${tokens.memory_available_for_tokens || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderSystem() {
            const system = metrics.system || {};
            
            return `
                <div class="glass-morphism rounded-2xl p-8 shadow-xl">
                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-8 flex items-center">
                        <span class="mr-3">üñ•Ô∏è</span>
                        System Resources
                    </h3>
                    
                    <div class="space-y-8">
                        <!-- CPU -->
                        <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-medium text-gray-800 dark:text-white">CPU Usage</span>
                                <span class="text-2xl font-bold ${getPerformanceColor(100 - (system.cpu?.percent || 0))}">${system.cpu?.percent || 0}%</span>
                            </div>
                            <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-2">
                                <div class="bg-gradient-to-r from-warp-400 to-electric-500 h-3 rounded-full transition-all duration-1000" 
                                     style="width: ${system.cpu?.percent || 0}%"></div>
                            </div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">
                                ${system.cpu?.count || 0} cores
                                ${system.cpu?.load_avg ? ` ‚Ä¢ Load: ${system.cpu.load_avg.map(l => l.toFixed(2)).join(', ')}` : ''}
                            </div>
                        </div>
                        
                        <!-- Memory -->
                        <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-medium text-gray-800 dark:text-white">Memory Usage</span>
                                <span class="text-2xl font-bold ${getPerformanceColor(100 - (system.memory?.percent || 0))}">${system.memory?.percent || 0}%</span>
                            </div>
                            <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-2">
                                <div class="bg-gradient-to-r from-purple-400 to-pink-500 h-3 rounded-full transition-all duration-1000" 
                                     style="width: ${system.memory?.percent || 0}%"></div>
                            </div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">
                                ${formatBytes(system.memory?.used || 0)} / ${formatBytes(system.memory?.total || 0)}
                                ‚Ä¢ ${system.memory?.available_gb || 0}GB available
                            </div>
                        </div>
                        
                        <!-- Disk -->
                        <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-medium text-gray-800 dark:text-white">Disk Usage</span>
                                <span class="text-2xl font-bold ${getPerformanceColor(100 - (system.disk?.percent || 0))}">${system.disk?.percent || 0}%</span>
                            </div>
                            <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-2">
                                <div class="bg-gradient-to-r from-orange-400 to-red-500 h-3 rounded-full transition-all duration-1000" 
                                     style="width: ${system.disk?.percent || 0}%"></div>
                            </div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">
                                ${formatBytes(system.disk?.free || 0)} free ‚Ä¢ ${formatBytes(system.disk?.total || 0)} total
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderContainer() {
            const container = metrics.container || {};
            
            return `
                <div class="glass-morphism rounded-2xl p-8 shadow-xl">
                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-8 flex items-center">
                        <span class="mr-3">üê≥</span>
                        Docker Container Metrics
                    </h3>
                    
                    ${container.name ? `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-3xl mb-2">üì¶</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Container</div>
                                <div class="font-semibold text-gray-800 dark:text-white">${container.name}</div>
                                <div class="text-xs text-gray-500 mt-1">${container.status}</div>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-3xl mb-2">‚ö°</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">CPU Usage</div>
                                <div class="font-semibold text-xl text-gray-800 dark:text-white">${container.cpu_percent || 'N/A'}</div>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-3xl mb-2">üíæ</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Memory</div>
                                <div class="font-semibold text-lg text-gray-800 dark:text-white">${container.memory_usage || 'N/A'}</div>
                                <div class="text-xs text-gray-500 mt-1">${container.memory_percent || ''}</div>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-3xl mb-2">üåê</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Network I/O</div>
                                <div class="font-semibold text-sm text-gray-800 dark:text-white">${container.network_io || 'N/A'}</div>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-3xl mb-2">üíΩ</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Block I/O</div>
                                <div class="font-semibold text-sm text-gray-800 dark:text-white">${container.block_io || 'N/A'}</div>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-3xl mb-2">‚öôÔ∏è</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Processes</div>
                                <div class="font-semibold text-xl text-gray-800 dark:text-white">${container.pids || 'N/A'}</div>
                            </div>
                        </div>
                    ` : `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">üö´</div>
                            <div class="text-xl text-gray-600 dark:text-gray-300">Container not running</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400 mt-2">${container.error || 'No container metrics available'}</div>
                        </div>
                    `}
                </div>
            `;
        }
        
        function renderTokens() {
            const tokenData = metrics.tokens || {};
            const summary = tokenData.usage_summary || {};
            const ollamaTokens = tokenData.ollama_tokens || {};
            
            return `
                <div class="space-y-8">
                    <!-- Performance Summary -->
                    <div class="glass-morphism rounded-2xl p-8 shadow-xl">
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-8 flex items-center">
                            <span class="mr-3">ü™ô</span>
                            AI Token Performance
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-4xl mb-3">‚ö°</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-2">Throughput</div>
                                <div class="text-2xl font-bold text-gray-800 dark:text-white">${summary.estimated_throughput_tokens_per_second || 0}</div>
                                <div class="text-xs text-gray-500">tokens/second</div>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-4xl mb-3">üìä</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-2">Performance Score</div>
                                <div class="text-2xl font-bold ${getPerformanceColor(summary.performance_score || 0)}">${Math.round(summary.performance_score || 0)}%</div>
                                <div class="text-xs text-gray-500">efficiency rating</div>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-black/20 rounded-xl p-6 text-center">
                                <div class="text-4xl mb-3">üéØ</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-2">System Impact</div>
                                <div class="text-lg font-bold text-gray-800 dark:text-white capitalize">${summary.system_load_impact || 'unknown'}</div>
                                <div class="text-xs text-gray-500">${summary.memory_available_for_tokens || 'N/A'} available</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Model Context Windows -->
                    <div class="glass-morphism rounded-2xl p-8 shadow-xl">
                        <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-6 flex items-center">
                            <span class="mr-3">üìö</span>
                            Model Context Windows
                        </h3>
                        
                        ${ollamaTokens.available_models && ollamaTokens.available_models.length > 0 ? `
                            <div class="space-y-4">
                                ${ollamaTokens.available_models.map(model => `
                                    <div class="bg-white/50 dark:bg-black/20 rounded-xl p-4">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-4">
                                                <div class="w-12 h-12 bg-gradient-to-br from-warp-400 to-electric-500 rounded-lg flex items-center justify-center">
                                                    <span class="text-white font-bold text-sm">${model.name.charAt(0).toUpperCase()}</span>
                                                </div>
                                                <div>
                                                    <div class="font-medium text-gray-800 dark:text-white">${model.name}</div>
                                                    <div class="text-sm text-gray-500">Size: ${model.size}</div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="font-semibold text-lg text-gray-800 dark:text-white">${model.estimated_context_tokens || 'N/A'}</div>
                                                <div class="text-xs text-gray-500">context tokens</div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-8">
                                <div class="text-4xl mb-3">üì≠</div>
                                <div class="text-gray-600 dark:text-gray-300">No model data available</div>
                            </div>
                        `}
                    </div>
                    
                    <!-- Active Models -->
                    <div class="glass-morphism rounded-2xl p-8 shadow-xl">
                        <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-6 flex items-center">
                            <span class="mr-3">‚ö°</span>
                            Active Models
                        </h3>
                        
                        ${ollamaTokens.active_models && ollamaTokens.active_models.length > 0 ? `
                            <div class="space-y-4">
                                ${ollamaTokens.active_models.map(model => `
                                    <div class="bg-gradient-to-r from-neon-500/20 to-electric-500/20 rounded-xl p-4 border border-neon-500/30">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-4">
                                                <div class="w-12 h-12 bg-neon-500 rounded-lg flex items-center justify-center animate-pulse">
                                                    <span class="text-black font-bold text-sm">‚ñ∂</span>
                                                </div>
                                                <div>
                                                    <div class="font-medium text-gray-800 dark:text-white">${model.name}</div>
                                                    <div class="text-sm text-gray-500">Running ‚Ä¢ ${model.size}</div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="font-semibold text-neon-500">Active</div>
                                                <div class="text-xs text-gray-500">${model.processor || 'CPU'}</div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-8">
                                <div class="text-4xl mb-3">üí§</div>
                                <div class="text-gray-600 dark:text-gray-300">No models currently running</div>
                                <div class="text-sm text-gray-500 mt-2">Models will appear here when active</div>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }
        
        function setView(view) {
            activeView = view;
            // Don't trigger initial animations when switching views
            const wasInitialLoad = isInitialLoad;
            isInitialLoad = false;
            renderDashboard();
            // Restore initial load state if it was true
            if (wasInitialLoad && !hasRenderedOnce) {
                isInitialLoad = true;
                hasRenderedOnce = true;
            }
        }
        
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            if (autoRefresh) {
                refreshInterval = setInterval(fetchMetrics, 5000);
            } else {
                if (refreshInterval) clearInterval(refreshInterval);
            }
            // Don't trigger animations for control updates
            isInitialLoad = false;
            renderDashboard();
        }
        
        let refreshInterval;
        
        // Initialize
        fetchMetrics();
        if (autoRefresh) {
            refreshInterval = setInterval(fetchMetrics, 5000);
        }
        
        // Handle window focus to resume auto-refresh
        window.addEventListener('focus', () => {
            if (autoRefresh && !refreshInterval) {
                refreshInterval = setInterval(fetchMetrics, 5000);
            }
        });
        
        // Handle window blur to pause auto-refresh
        window.addEventListener('blur', () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
        });
    </script>
</body>
</html>
